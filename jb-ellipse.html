<link rel="import" href="/components/polymer/polymer.html" />
<link rel="import" href="/components/jb-3js/jb-3js-helper-color.html" />
<link rel="import" href="/components/jb-3js/jb-3js-helper-position.html" />

<dom-module id="jb-ellipse">
    <template>
        <content></content>
    </template>
</dom-module>

<script>
    Polymer({
        is: 'jb-ellipse',
        behaviors: [ColorBehavior],
        properties: {
        	name: {
        		type: String,
        		value: 'Ellipse'
        	},
        	semiMajorAxis: {
        		type: Number,
        		value: 1
        	},
			semiMinorAxis: {
				type: Number,
				value: 1
			},
			drawMajorAxis: Boolean,
			drawMinorAxis: Boolean
        },
        observers: [
        	'propertiesChanged(semi-major-axis, semi-minor-axis)'
        ],
        created: function() {
       		var material = new THREE.LineBasicMaterial(this.color);

       		// Create the final Object3d to add to the scene
       		this.mesh = new THREE.Line(new THREE.Geometry(), material);
       		this.majorLineMesh = new THREE.Line(new THREE.Geometry(), material);
       		this.minorLineMesh = new THREE.Line(new THREE.Geometry(), material);
       		this.majorLineMesh.geometry.vertices.push(new THREE.Vector3(0, 0, 0), new THREE.Vector3(0, 0, 0));
       		this.minorLineMesh.geometry.vertices.push(new THREE.Vector3(0, 0, 0), new THREE.Vector3(0, 0, 0));
       		this._renewGeometry();
        },
        propertiesChanged: function(a, b) {
        	this.semiMajorAxis = a;
        	this.semiMinorAxis = b;
        	this._renewGeometry();
        },
        _renewGeometry: function() {
       		var curve = new THREE.EllipseCurve(
           		0, 0,             // ax, aY
          		this.semiMajorAxis, this.semiMinorAxis, // xRadius, yRadius
          		0,  2 * Math.PI,  // aStartAngle, aEndAngle
         		false,            // aClockwise
          		0                 // aRotation
          	);
          	var path = new THREE.Path(curve.getPoints(50));
          	this.mesh.geometry = path.createPointsGeometry(50);
          	this.majorLineMesh.geometry.vertices[0].x = -this.semiMajorAxis;
          	this.majorLineMesh.geometry.vertices[1].x = this.semiMajorAxis;
          	this.minorLineMesh.geometry.vertices[0].y = -this.semiMinorAxis;
          	this.minorLineMesh.geometry.vertices[1].y = this.semiMinorAxis;
        },
        ready: function() {
	        this.mesh.name = this.name;
	        this.mesh.material.color = new THREE.Color(this.color);
	        this._renewGeometry();
        },
        attached: function() {
            this.fire('add-to-scene', this.mesh);
            if (this.drawMajorAxis) {
            	this.fire('add-to-scene', this.majorLineMesh);
            }
            if (this.drawMinorAxis) {
            	this.fire('add-to-scene', this.minorLineMesh);
            }
        }
    });
</script>
